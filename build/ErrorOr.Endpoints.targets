<Project>
    <!--
      Enables AOT-compatible JSON serialization for ErrorOr endpoints.

      When consuming project sets:
        <EnableErrorOrJsonContext>true</EnableErrorOrJsonContext>

      This generates a partial ErrorOrJsonContext class that includes
      Error, ErrorOr<T>, and common response types in the JsonSerializable list.
    -->
    <PropertyGroup>
        <EnableErrorOrJsonContext Condition="'$(EnableErrorOrJsonContext)' == ''">false</EnableErrorOrJsonContext>
    </PropertyGroup>

    <Target Name="GenerateErrorOrJsonContext"
            BeforeTargets="CoreCompile"
            Condition="'$(EnableErrorOrJsonContext)' == 'true'">
        <ItemGroup>
            <Compile Include="$(MSBuildThisFileDirectory)ErrorOrJsonContext.g.cs"
                     Condition="Exists('$(MSBuildThisFileDirectory)ErrorOrJsonContext.g.cs')"/>
        </ItemGroup>
    </Target>
</Project>